AWSTemplateFormatVersion: '2010-09-09'
Transform: 'AWS::Serverless-2016-10-31'
Description: test Fairi Jenkins SAM Deployment
#Parameter Configuration Required to deploy Lambdas:
Parameters:
  S3Bucket:
    Type: String
    Default: "lambdafairi"
Resources:
#IAM Role Required for Lambdas to function Properly
  LambdaRole:
    Type: AWS::IAM::Role
    Properties:
      ManagedPolicyArns:     
      - arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
      AssumeRolePolicyDocument:
        Version: '2012-10-17'
        Statement:
        - Effect: Allow
          Principal:
            Service:
            - lambda.amazonaws.com
          Action:
          - sts:AssumeRole
      Path: "/"
      Policies:
        - PolicyName: PublishVersion
          PolicyDocument:
            Version: 2012-10-17
            Statement:
            - Effect: Allow
              Action: ['lambda:PublishVersion', 'lambda:CreateAlias', 'lambda:GetAlias', 'lambda:ListAliases', 'lambda:UpdateAlias']
              Resource: '*'
            - Effect: Allow
              Action:
                - s3:Get*
              Resource: '*'

  lambda:
    Type: 'AWS::Serverless::Function'
    Properties:
      FunctionName: lambda-demo
      Handler: lambda.py.lambda_handler
      Runtime: python3.9
      CodeUri: 
        Bucket:
          Ref: S3Bucket
        Key: lambdag.zip
      Description: test Jenkins fairi Deployment
      MemorySize: 1024
      Timeout: 900
      Role: 'arn:aws:iam::491655376147:role/Cloud1_0_Dev_PowerUser'
